[build]
builder = "NIXPACKS"
buildCommand = "cd ../.. && pnpm install && pnpm -F @chess-app/shared build && pnpm -F api build && pnpm -F api db:migrate"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[start]
cmd = "cd ../.. && pnpm -F api start"

[nixpacks]
nixPkgs = ["nodejs-20_x", "pnpm"]
